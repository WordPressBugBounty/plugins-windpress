import{d as G,a as H}from"./worker-2mJa2xxM.js";import{ai as O,aj as $,l as K,m as S}from"./dashboard-hef6uuRo.js";import{U as z,i as I,S as A,a as U}from"./_initCloneObject-DlLbeobz.min.js";import{M as Z,e as F,i as k}from"./_toKey-BxB36GnB.min.js";import{S as D,b as L}from"./isObject-K1YoVIH1.min.js";import{af as V,V as J,a6 as Q}from"./runtime-core.esm-bundler-HqF9pg4M.min.js";var W="__lodash_hash_undefined__";function X(e){return this.__data__.set(e,W),this}function Y(e){return this.__data__.has(e)}function E(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Z;++t<r;)this.add(e[t])}E.prototype.add=E.prototype.push=X,E.prototype.has=Y;function ee(e,t){for(var r=-1,s=e==null?0:e.length;++r<s;)if(t(e[r],r,e))return!0;return!1}function te(e,t){return e.has(t)}var re=1,ne=2;function M(e,t,r,s,o,a){var c=r&re,l=e.length,f=t.length;if(l!=f&&!(c&&f>l))return!1;var h=a.get(e),g=a.get(t);if(h&&g)return h==t&&g==e;var p=-1,u=!0,y=r&ne?new E:void 0;for(a.set(e,t),a.set(t,e);++p<l;){var _=e[p],m=t[p];if(s)var w=c?s(m,_,p,t,e,a):s(_,m,p,e,t,a);if(w!==void 0){if(w)continue;u=!1;break}if(y){if(!ee(t,function(n,i){if(!te(y,i)&&(_===n||o(_,n,r,s,a)))return y.push(i)})){u=!1;break}}else if(!(_===m||o(_,m,r,s,a))){u=!1;break}}return a.delete(e),a.delete(t),u}function ae(e){var t=-1,r=Array(e.size);return e.forEach(function(s,o){r[++t]=[o,s]}),r}function se(e){var t=-1,r=Array(e.size);return e.forEach(function(s){r[++t]=s}),r}var ie=1,oe=2,ue="[object Boolean]",ce="[object Date]",le="[object Error]",fe="[object Map]",de="[object Number]",ve="[object RegExp]",he="[object Set]",pe="[object String]",_e="[object Symbol]",me="[object ArrayBuffer]",ge="[object DataView]",T=D?D.prototype:void 0,x=T?T.valueOf:void 0;function ye(e,t,r,s,o,a,c){switch(r){case ge:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case me:return!(e.byteLength!=t.byteLength||!a(new z(e),new z(t)));case ue:case ce:case de:return F(+e,+t);case le:return e.name==t.name&&e.message==t.message;case ve:case pe:return e==t+"";case fe:var l=ae;case he:var f=s&ie;if(l||(l=se),e.size!=t.size&&!f)return!1;var h=c.get(e);if(h)return h==t;s|=oe,c.set(e,t);var g=M(l(e),l(t),s,o,a,c);return c.delete(e),g;case _e:if(x)return x.call(e)==x.call(t)}return!1}var be=1,we=Object.prototype,je=we.hasOwnProperty;function Ee(e,t,r,s,o,a){var c=r&be,l=O(e),f=l.length,h=O(t),g=h.length;if(f!=g&&!c)return!1;for(var p=f;p--;){var u=l[p];if(!(c?u in t:je.call(t,u)))return!1}var y=a.get(e),_=a.get(t);if(y&&_)return y==t&&_==e;var m=!0;a.set(e,t),a.set(t,e);for(var w=c;++p<f;){u=l[p];var n=e[u],i=t[u];if(s)var d=c?s(i,n,u,t,e,a):s(n,i,u,e,t,a);if(!(d===void 0?n===i||o(n,i,r,s,a):d)){m=!1;break}w||(w=u=="constructor")}if(m&&!w){var v=e.constructor,b=t.constructor;v!=b&&"constructor"in e&&"constructor"in t&&!(typeof v=="function"&&v instanceof v&&typeof b=="function"&&b instanceof b)&&(m=!1)}return a.delete(e),a.delete(t),m}var Pe=1,q="[object Arguments]",B="[object Array]",P="[object Object]",Ae=Object.prototype,C=Ae.hasOwnProperty;function xe(e,t,r,s,o,a){var c=k(e),l=k(t),f=c?B:$(e),h=l?B:$(t);f=f==q?P:f,h=h==q?P:h;var g=f==P,p=h==P,u=f==h;if(u&&I(e)){if(!I(t))return!1;c=!0,g=!1}if(u&&!g)return a||(a=new A),c||U(e)?M(e,t,r,s,o,a):ye(e,t,f,r,s,o,a);if(!(r&Pe)){var y=g&&C.call(e,"__wrapped__"),_=p&&C.call(t,"__wrapped__");if(y||_){var m=y?e.value():e,w=_?t.value():t;return a||(a=new A),o(m,w,r,s,a)}}return u?(a||(a=new A),Ee(e,t,r,s,o,a)):!1}function N(e,t,r,s,o){return e===t?!0:e==null||t==null||!L(e)&&!L(t)?e!==e&&t!==t:xe(e,t,r,s,N,o)}function R(e,t){return N(e,t)}const Oe=G("volume",()=>{const e=H(),t=K(),r=V({entries:[]}),s=V({entries:[]}),o=J(null);function a(n){return n=n.replace(/[^a-zA-Z0-9._/-]+/g,""),n=n.replace(/\.{2,}/g,"."),n=n.replace(/\/{2,}/g,"/"),n=n.replace(/^[._/ -]+|[._/ -]+$/g,""),n}function c(n){let i=n.split("/").map(a).join("/");i=a(i);const d=r.entries.findIndex(v=>v.relative_path===i);if(d!==-1){if(r.entries[d].hidden===!1)throw new Error(wp.i18n.__(`A file named "${i}" already exists`,"windpress"));r.entries[d].hidden=!1,r.entries[d].content=`/* file: ${i} */

`}else r.entries.push({name:i.split("/").pop()||"",content:`/* file: ${i} */

`,relative_path:`${i}`,handler:"internal"});o.value=`${i}`}function l(n){const i=r.entries.findIndex(d=>d.relative_path===n.relative_path);r.entries[i].content="",r.entries[i].hidden=!0,o.value===n.relative_path&&(o.value=null)}function f(n,i){const d=r.entries.findIndex(j=>j.relative_path===n.relative_path);let v=i.split("/").map(a).join("/");v=a(v);const b=r.entries.findIndex(j=>j.relative_path===v);if(b!==-1){if(r.entries[b].hidden===!1)throw new Error(wp.i18n.__(`A file named "${v}" already exists`,"windpress"));r.entries[b].hidden=!1,r.entries[b].content=r.entries[d].content,r.entries[b].signature&&delete r.entries[b].signature}else{const j=S(r.entries[d]);j.relative_path=v,j.name=v.split("/").pop()||"",j.content=r.entries[d].content,j.hidden=!1,j.signature=void 0,r.entries.push(j)}l(n)}function h(n){const i=r.entries.findIndex(d=>d.relative_path===n.relative_path);r.entries[i].content=""}function g(){return r.entries.reduce((n,i)=>(n[`/${i.relative_path}`]=i.content,n),{})}async function p(){return t.add("volume.doPull"),await e.request("/admin/volume/index",{method:"GET"}).then(n=>n.data).then(n=>{const i=n.entries;r.entries=i,y()}).catch(n=>{}).finally(()=>{t.remove("volume.doPull")})}async function u(){return t.add("volume.doPush"),e.request("/admin/volume/store",{method:"POST",data:{volume:{entries:r.entries}}}).then(n=>(y(),{message:n.data.message,success:!0})).catch(n=>{throw new Error(n.response?n.response.data.message:n.message)}).finally(()=>{t.remove("volume.doPush")})}function y(){r.entries.length!==0&&(o.value===null&&(o.value="main.css"),_.value&&(s.entries=S(r.entries)))}const _=Q(()=>!R(r.entries,s.entries));function m(n){const i=r.entries.find(v=>v.relative_path===n),d=s.entries.find(v=>v.relative_path===n);return!R(i,d)}async function w(){return r.entries.length===0?p():Promise.resolve()}return{data:r,initData:s,activeViewEntryRelativePath:o,hasChanged:_,addNewEntry:c,getKVEntries:g,doPull:p,doPush:u,entryHasChanged:m,softDeleteEntry:l,resetEntry:h,renameEntry:f,cleanPath:a,initPull:w}});export{Oe as u};
