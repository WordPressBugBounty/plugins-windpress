import{l as r}from"../../logger-BTW-zIW3.js";r("Loading..."),(async()=>{let d,a;for(r("waiting for the rootContainer...");!d;)d=document.querySelector('iframe[name="editor-canvas"]'),await new Promise(i=>setTimeout(i,100));r("finding WindPress script...");let m=!1,h=setTimeout(()=>{m=!0},45e3);for(;!m;){if(a=document.querySelectorAll("script"),a=Array.from(a).filter(i=>{let o=i.getAttribute("id");return o&&(o.startsWith("windpress:")||o.startsWith("vite-client"))&&!o.startsWith("windpress:integration-")}),a.length>0){clearTimeout(h);break}await new Promise(i=>setTimeout(i,100))}if(m){r("time out! failed to find WindPress script");return}r("found WindPress script");let y=d.contentWindow||d,f=d.contentDocument||y.document;for(;!f.head;)await new Promise(i=>setTimeout(i,300));r("injecting WindPress script into the root container");let g=f.querySelectorAll("script");Array.from(g).some(i=>{let o=i.getAttribute("id");return o&&o.startsWith("windpress:")})?r("WindPress script is already injected, skipping the injection process..."):(r("starting the root injection process..."),a.forEach(i=>{f.head.appendChild(document.createRange().createContextualFragment(i.outerHTML))}));let u=null;new MutationObserver(async i=>{let o=!1,n=[],s=2e3;for(const t of i){if(o)break;t.type==="childList"&&(t.removedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&e.matches("div.components-modal__screen-overlay")&&(u=null)}),t.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&e.matches("body > div.components-modal__screen-overlay")&&(u=e,o=!0)}))}if(o){for(r("waiting for the patternIframes...");n.length===0&&s>0;)n=u.querySelectorAll("div.block-editor-block-preview__container > div > div > div.block-editor-iframe__scale-container > iframe"),s-=100,await new Promise(t=>setTimeout(t,100));if(s<=0&&n.length===0){r("time out! failed to find the patternIframes");return}n.forEach(t=>{let e=(t.contentDocument||t.contentWindow.document).head;Array.from(e.querySelectorAll("script")).some(c=>{let l=c.getAttribute("id");return l&&l.startsWith("windpress:")})?r("WindPress script is already injected into the pattern iframe, skipping the injection process..."):(r("injecting WindPress script into the pattern iframe"),a.forEach(c=>{e.appendChild(document.createRange().createContextualFragment(c.outerHTML))}))}),n=[]}}).observe(document.body,{childList:!0,subtree:!1});let p=null;new MutationObserver(async i=>{let o=!1,n=[],s=2e4;for(const t of i){if(o)break;t.type==="childList"&&(t.removedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&e.matches("div.block-editor-inserter__category-panel")&&(p=null)}),t.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&e.matches("div.block-editor-inserter__category-panel")&&(p=e,o=!0)}))}if(o){for(r("waiting for the patternIframes...");n.length===0&&s>0;)n=p.querySelectorAll("div.block-editor-block-preview__container > div > div > div.block-editor-iframe__scale-container > iframe"),s-=100,await new Promise(t=>setTimeout(t,100));if(s<=0&&n.length===0){r("time out! failed to find the patternIframes");return}n.forEach(t=>{let e=(t.contentDocument||t.contentWindow.document).head;Array.from(e.querySelectorAll("script")).some(c=>{let l=c.getAttribute("id");return l&&l.startsWith("windpress:")})?r("WindPress script is already injected into the pattern iframe, skipping the injection process..."):(r("injecting WindPress script into the pattern iframe"),a.forEach(c=>{e.appendChild(document.createRange().createContextualFragment(c.outerHTML))}))}),n=[]}}).observe(document.body,{childList:!0,subtree:!0})})();
